<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ultimate Mobile Tasks</title>
    <style>
        :root { --primary: #007bff; --bg: #f0f2f5; --danger: #dc3545; --gray: #6c757d; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); display: flex; justify-content: center; padding: 15px; margin: 0; }
        .container { width: 100%; max-width: 450px; background: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); box-sizing: border-box; }
        
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        h2 { margin: 0; color: #333; font-size: 1.4rem; }
        
        .clear-btn { font-size: 11px; color: var(--danger); cursor: pointer; border: 1px solid var(--danger); padding: 5px 12px; border-radius: 20px; background: transparent; font-weight: bold; }

        .search-bar { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 20px; box-sizing: border-box; font-size: 14px; background: #fafafa; }

        .input-area { display: flex; flex-direction: column; gap: 10px; margin-bottom: 25px; padding-bottom: 20px; border-bottom: 1px solid #eee; }
        input[type="text"], input[type="datetime-local"] { padding: 12px; border: 2px solid #eee; border-radius: 12px; font-size: 16px; outline: none; }
        button#addBtn { padding: 14px; background: var(--primary); color: white; border: none; border-radius: 12px; font-weight: bold; font-size: 16px; }

        ul { list-style: none; padding: 0; margin: 0; }
        li { background: #fff; margin-bottom: 10px; padding: 12px; border-radius: 12px; display: flex; align-items: flex-start; gap: 10px; border: 1px solid #eee; }

        input[type="checkbox"] { width: 20px; height: 20px; margin-top: 4px; accent-color: var(--primary); }

        .task-info { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .task-text { font-size: 15px; color: #333; font-weight: 500; word-wrap: break-word; }
        .task-date { font-size: 11px; color: var(--gray); margin-top: 2px; }

        .completed { background: #f9f9f9; opacity: 0.7; }
        .completed .task-text { text-decoration: line-through; color: #aaa; }
        .delete-btn { color: #ccc; font-size: 18px; cursor: pointer; padding: 0 5px; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h2>My Tasks</h2>
        <button class="clear-btn" onclick="clearCompleted()">Clear Finished</button>
    </header>

    <input type="text" id="searchInput" class="search-bar" placeholder="ðŸ” Search your tasks..." onkeyup="renderTasks()">

    <div class="input-area">
        <input type="text" id="taskInput" placeholder="New task name..." autocomplete="off">
        <input type="datetime-local" id="dateInput">
        <button id="addBtn" onclick="addTask()">Add Task</button>
    </div>

    <ul id="taskList"></ul>
</div>

<script>
    document.addEventListener("DOMContentLoaded", renderTasks);

    function addTask() {
        const input = document.getElementById("taskInput");
        const dateInput = document.getElementById("dateInput");
        if (input.value.trim() === "") return;

        const taskObj = {
            id: Date.now(),
            text: input.value,
            date: dateInput.value,
            completed: false
        };

        const tasks = getStoredTasks();
        tasks.push(taskObj);
        saveTasks(tasks);
        
        input.value = "";
        dateInput.value = "";
        renderTasks();
    }

    function toggleComplete(id) {
        const tasks = getStoredTasks().map(t => {
            if (t.id === id) t.completed = !t.completed;
            return t;
        });
        saveTasks(tasks);
        renderTasks();
    }

    function removeTask(id) {
        const tasks = getStoredTasks().filter(t => t.id !== id);
        saveTasks(tasks);
        renderTasks();
    }

    function clearCompleted() {
        if(!confirm("Delete all finished tasks?")) return;
        const tasks = getStoredTasks().filter(t => !t.completed);
        saveTasks(tasks);
        renderTasks();
    }

    function renderTasks() {
        const ul = document.getElementById("taskList");
        const searchQuery = document.getElementById("searchInput").value.toLowerCase();
        ul.innerHTML = "";
        
        let tasks = getStoredTasks();

        // 1. Filter by Search Query
        tasks = tasks.filter(task => task.text.toLowerCase().includes(searchQuery));

        // 2. Sort: Incomplete first, then by date
        tasks.sort((a, b) => {
            if (a.completed !== b.completed) return a.completed - b.completed;
            if (!a.date) return 1;
            if (!b.date) return -1;
            return new Date(a.date) - new Date(b.date);
        });

        tasks.forEach(task => {
            const li = document.createElement("li");
            if (task.completed) li.classList.add("completed");

            const dateDisplay = task.date ? new Date(task.date).toLocaleString([], {month: 'short', day: 'numeric', hour: '2-digit', minute:'2-digit'}) : "No deadline";

            li.innerHTML = `
                <input type="checkbox" ${task.completed ? 'checked' : ''} onchange="toggleComplete(${task.id})">
                <div class="task-info">
                    <span class="task-text">${task.text}</span>
                    <span class="task-date">ðŸ“… ${dateDisplay}</span>
                </div>
                <span class="delete-btn" onclick="removeTask(${task.id})">âœ•</span>
            `;
            ul.appendChild(li);
        });
    }

    function getStoredTasks() {
        return localStorage.getItem("tasks") ? JSON.parse(localStorage.getItem("tasks")) : [];
    }

    function saveTasks(tasks) {
        localStorage.setItem("tasks", JSON.stringify(tasks));
    }
</script>

</body>
</html>
